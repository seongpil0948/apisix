아래는 TLS나 사용자 인증, 불필요한 파라미터 없이 alias를 활용해 매번 입력하는 파라미터를 최소화한, 풍부한 테스트 방법을 포함한 etcd 클러스터 테스트 가이드입니다.

---

# etcd 클러스터 테스트 가이드

이 문서는 etcd 클러스터의 상태와 기능(데이터 읽기/쓰기, TTL, 부하 테스트 등)을 간편하게 검증할 수 있도록 구성되었습니다.  
별도의 TLS나 사용자 인증 없이, 아래 alias 설정을 통해 최소한의 파라미터로 테스트 명령어를 실행할 수 있습니다.

> **주의:**  
> 이 가이드는 개발 및 테스트 환경을 대상으로 하며, 운영 환경에서는 필요에 따라 추가 보안 설정을 적용하시기 바랍니다.

---

## 1. 사전 준비

터미널에 아래 alias를 설정하여, 매번 파라미터를 입력하지 않도록 합니다.

```bash
alias ec='ETCDCTL_API=3 etcdctl --endpoints=http://10.101.99.101:2379'
```

이제 `ec` 명령어를 사용하면 기본 설정이 자동으로 적용됩니다.

---

## 2. 클러스터 상태 확인

### 2.1 엔드포인트 상태 점검

클러스터 내 모든 엔드포인트의 상태를 표 형식으로 확인합니다:

```bash
ec endpoint status --cluster -w=table
```

### 2.2 엔드포인트 헬스 체크

각 엔드포인트가 정상적으로 응답하는지 확인합니다:

```bash
ec endpoint health --cluster -w=table
```

### 2.3 해시값(데이터 일관성) 확인

클러스터 내 Key-Value 데이터의 해시값을 확인하여 데이터 일관성을 점검합니다:

```bash
ec endpoint hashkv --cluster -w=table
```

### 2.4 클러스터 멤버 목록 확인

현재 클러스터에 가입된 멤버들을 표 형식으로 확인합니다:

```bash
ec member list -w=table
```

---

## 3. 데이터 읽기/쓰기 테스트

### 3.1 키-값 저장

한 노드에 데이터를 저장해 보겠습니다. 예를 들어, `/test/message` 키에 `"Hello, etcd cluster!"` 값을 저장합니다:

```bash
ec put /test/message "Hello, etcd cluster!"
```

### 3.2 데이터 읽기

다른 노드 또는 동일 엔드포인트에서 데이터가 복제되었는지 확인합니다:

```bash
ec get /test/message
```

출력 결과에 `"Hello, etcd cluster!"`가 표시되면 데이터 저장 및 복제 기능이 정상임을 의미합니다.

### 3.3 데이터 삭제

저장된 데이터를 삭제하여 삭제 기능을 테스트합니다:

```bash
ec del /test/message
```

삭제 후, 다시 get 명령어로 확인하여 데이터가 제거되었는지 점검합니다.

---

## 4. 추가 테스트 방법

### 4.1 TTL (만료 시간) 테스트

TTL 기능을 이용하여 키가 일정 시간 후 자동 삭제되는지 확인합니다.  
예를 들어, 5초 후 만료되는 임시 키를 테스트합니다:

```bash
# 임시 키 저장 (lease 옵션을 통해 5초 후 만료)
ec put /test/temp "Temporary Value" --lease=5

# 저장 후 5초 정도 기다린 후, 키 확인
sleep 6
ec get /test/temp
```

TTL 기능이 정상적으로 동작한다면 5초 후 키가 조회되지 않아야 합니다.

### 4.2 대량 데이터 및 부하 테스트

여러 키를 빠르게 저장하고 읽어 클러스터의 부하 처리 능력을 테스트합니다:

```bash
# 1부터 100까지의 키를 저장
for i in {1..100}; do
  ec put /test/key$i "value$i"
done

# 저장된 100개의 키를 조회
for i in {1..100}; do
  ec get /test/key$i
done
```

### 4.3 클러스터 확장 테스트

런타임 재구성을 통해 클러스터 확장이 올바르게 동작하는지 확인합니다.  
예를 들어, 새 노드(`new-node`)를 추가하려면 아래와 같이 실행합니다:

```bash
ec member add new-node --peer-urls=http://<새노드_IP>:<Peer_Port>
```

추가 후, 다시 멤버 목록을 확인하여 새 노드가 등록되었는지 검증합니다:

```bash
ec member list -w=table
```

> **참고:**  
> 초기 Discovery Token은 클러스터 부트스트랩 시에만 사용되며, 클러스터 형성 후에는 etcd의 Raft consensus가 멤버십을 관리합니다.  
> 따라서 클러스터 확장 시에는 `member add` 명령어만 사용하면 되며, 별도의 토큰 교체는 필요하지 않습니다.

---

## 5. 결론

이 가이드를 통해 alias를 사용하여 최소한의 파라미터로 etcd 클러스터의 상태를 확인하고,  
- 엔드포인트 상태 및 헬스 점검  
- 데이터 읽기/쓰기, 삭제, TTL 기능 테스트  
- 대량 데이터 부하 테스트  
- 클러스터 확장 테스트  

등 다양한 기능을 검증할 수 있습니다.  
각 테스트 명령어는 필요 시 상황에 맞게 수정하여 사용할 수 있으며, 운영 환경에서는 추가 보안 설정을 적용하시기 바랍니다.

--- 

이상으로, 간단하지만 다양한 테스트 방법을 포함한 etcd 클러스터 검증 가이드를 마칩니다.  
추가 문의사항이 있으시면 언제든지 말씀해 주세요.