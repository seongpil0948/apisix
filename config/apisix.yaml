apisix:
  proxy_mode: http&stream
  node_listen:
    - port: 9080      # HTTP 트래픽 처리
  stream_proxy:
    tcp:
      - 6380 # listen on 9100 ports of all network interfaces for TCP requests
      - "127.0.0.1:6380"
    # udp:
    #   - 9200 # listen on 9200 ports of all network interfaces for UDP requests
    #   - "127.0.0.1:9211"

deployment:
  role: traditional
  role_traditional:
    config_provider: etcd
  etcd:
    # 고가용성을 위해 두 서버의 etcd 엔드포인트 모두 지정
    host:
      - "http://10.101.99.100:2379"
      - "http://10.101.99.101:2379"
    prefix: "/apisix"
    timeout: 30 # etcd 응답 타임아웃(초 단위)
  admin:
    enable_admin_cors: true # Dashboard 연동 등에서 CORS 허용
    admin_api_version: v3 # Admin API 버전 v3 사용
    admin_key_required: true # Admin API 접근 시 키 필요
    admin_key:
      - name: admin
        key: "1234qwer!!" # 실제 운영 환경에서는 보다 복잡한 값으로 변경할 것
        role: admin
    allow_admin:
      - 0.0.0.0/0 # 필요 시 특정 IP 범위로 제한 가능
    admin_listen:
      ip: 0.0.0.0
      port: 9180


plugin_attr:
  # Prometheus 모니터링 설정
  prometheus:
    export_addr:
      ip: "0.0.0.0"
      port: 9091

plugins:
  - authz-keycloak
  - aws-lambda
  - basic-auth
  - cors
  - echo
  - ext-plugin-post-req
  - ext-plugin-post-resp
  - ext-plugin-pre-req
  - file-logger
  - forward-auth
  - jwt-auth
  - kafka-logger
  - kafka-proxy
  - log-rotate
  - node-status
  - opentelemetry
  - prometheus
  - public-api
  - serverless-post-function
  - serverless-pre-function
  - syslog
  - proxy-rewrite
